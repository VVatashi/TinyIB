!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=17)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qid=function(e){return document.getElementById(e)},t.qs=function(e,t=null){return t||(t=document),t.querySelector(e)},t.qsa=function(e,t=null){t||(t=document);const s=t.querySelectorAll(e);return Array.prototype.slice.call(s)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.manager=e}onReady(){}onResize(){}onPostInsert(e){}onEvent(e,t){}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=function(e,t=null){const s=`; ${document.cookie}`.split(`; ${e}=`);if(2===s.length){const e=s.pop().split(";").shift();return decodeURIComponent(e)}return t},t.set=function(e,t,s){const n=encodeURIComponent(t),i=s.toUTCString();document.cookie=`${e}=${n}; path=/; expires=${i}`}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Ready=0]="Ready",e[e.PostsInserted=1]="PostsInserted"}(t.Event||(t.Event={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static format(e,t){const s=t.time_locale,n=t.time_locale_custom_value,i=t.time_zone,o=t.time_zone_fixed_offset,r=t.time_format,a=t.time_format_custom_value;if("custom"===s&&(e=e.setLocale(n)),"fixed"===i){const t="UTC"+(o>=0?"+":"")+o.toString();e=e.setZone(t)}return"custom"===r?e.toFormat(a):e.toFormat("d.LL.yyyy HH:mm:ss")}}},function(e,t){e.exports=luxon},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3),i=s(0);t.PostingForm=class{constructor(){this.isInThread=!1,this.file=null}dispatchEvent(e,t){switch(e){case n.Event.Ready:this.onReady();break;case n.Event.PostsInserted:this.onPostsInserted(t.posts)}}onReady(){if(this.wrapper=i.qs("#posting-form-wrapper"),!this.wrapper)return;this.form=i.qs("#posting-form",this.wrapper);const e=i.qs('[name="parent"]',this.form);this.isInThread=0!=+e.value,this.subject=i.qs('[name="subject"]',this.form),this.name=i.qs('[name="name"]',this.form),this.fileInput=i.qs('[name="file"]',this.form),this.message=i.qs('[name="message"]',this.form),this.status=i.qs("#posting-form-status",this.form),this.preview=i.qs("#posting-form-preview",this.form),this.submit=i.qs('[type="submit"]',this.form),this.close=i.qs("#posting-form-close",this.form),this.previewRemove=i.qs("#posting-form-preview-remove",this.form);const t=localStorage["posting-form.name"];t&&(this.name.value=t),this.name.addEventListener("change",e=>{localStorage["posting-form.name"]=this.name.value}),this.fileInput.addEventListener("change",e=>{this.file=null,this.fileInput.files&&this.fileInput.files.length?this.showPreview(this.fileInput.files[0]):this.hidePreview()}),this.message.addEventListener("keydown",e=>{10!=e.keyCode&&13!=e.keyCode||!e.ctrlKey||this.submitForm()}),this.message.addEventListener("paste",e=>{const t=e.clipboardData||e.originalEvent.clipboardData,s=Array.prototype.slice.call(t.items).filter(e=>e.type.startsWith("image/")||e.type.startsWith("audio/")||e.type.startsWith("video/"))[0];s&&(this.file=s.getAsFile(),this.showPreview(this.file))}),this.form.addEventListener("submit",e=>{e.preventDefault(),this.submitForm()}),this.close.addEventListener("click",e=>{e.preventDefault(),this.restoreForm()}),this.previewRemove.addEventListener("click",e=>{e.preventDefault(),this.resetFileField()})}onPostsInserted(e){e.forEach(e=>{i.qsa("a[data-reflink]",e).forEach(t=>{const s=+t.getAttribute("data-reflink");t.addEventListener("click",t=>{t.preventDefault(),this.isInThread&&this.moveFormToPost(e),this.insert(`>>${s}\n`,{newLine:!0})})})})}submitForm(){const e=`${window.baseUrl}/ajax/post/create`,t=new FormData(this.form);this.file&&t.append("file",this.file);const s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("Accept","application/json"),s.withCredentials=!0,s.upload.addEventListener("progress",e=>{const t=Math.ceil(e.loaded/e.total*100);this.status.textContent=`Uploading... ${t}%`}),s.addEventListener("readystatechange",e=>{if(s.readyState===XMLHttpRequest.DONE)if(this.setFormState({enabled:!0}),201===s.status)if(this.resetForm(),this.status.textContent="",this.restoreForm(),this.isInThread){const e=i.qs(".de-thr-updater-link");e&&e.click()}else{const e=s.getResponseHeader("Location");e&&(window.location.href=e)}else{const e=JSON.parse(s.responseText);e&&e.error?this.status.textContent=`Error: ${e.error}`:this.status.textContent=`Error: ${s.status} ${s.statusText}`}}),s.send(t),this.setFormState({enabled:!1})}setFormState({enabled:e}){[this.subject,this.name,this.fileInput,this.message,this.submit].filter(e=>e).forEach(t=>{t.disabled=!e})}resetForm(){[this.subject,this.message].filter(e=>e).forEach(e=>{e.value=""}),this.resetFileField()}resetFileField(){this.fileInput&&(this.fileInput.type="text",this.fileInput.value="",this.fileInput.type="file"),this.file=null,this.hidePreview()}moveFormToPost(e){this.form.style.marginLeft="0",this.close.classList.remove("hidden"),e.parentElement.insertBefore(this.form,e.nextSibling)}restoreForm(){this.form.style.marginLeft="auto",this.close.classList.add("hidden"),this.wrapper.insertBefore(this.form,null),this.wrapper.scrollIntoView()}showPreview(e){const t=new FileReader;t.addEventListener("load",e=>{let t=i.qs("#posting-form-preview-image",this.preview);t||((t=document.createElement("img")).id="posting-form-preview-image",t.classList.add("posting-form__preview-image"),this.preview.appendChild(t)),t.src=e.target.result,this.preview.classList.remove("hidden")}),t.readAsDataURL(e)}hidePreview(){this.preview.classList.add("hidden")}insert(e,{newLine:t}={newLine:!1}){if(this.message){const s=this.message.value,n=this.message.selectionStart,i=this.message.selectionEnd,o=s.substring(0,n),r=s.substring(i),a=t&&o.length>0&&!o.endsWith("\n")&&!e.startsWith("\n");this.message.value=[o,a?"\n":"",e,r].join(""),this.message.focus();const c=n+e.length+(a?1:0);this.message.selectionStart=c,this.message.selectionEnd=c}return!1}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(6);t.PostingForm=n.PostingForm},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3),i=s(0);t.ComponentManager=class{constructor(){this.components={};const e=new MutationObserver(e=>{const t=e.map(e=>{const t=e.addedNodes;return Array.prototype.slice.call(t).filter(e=>e.nodeType===Node.ELEMENT_NODE).map(e=>e.classList.contains("post")?[e]:i.qsa(".post",e)).reduce((e,t)=>e.concat(t),[])}).reduce((e,t)=>e.concat(t),[]);t.length>0&&this.dispatchEvent(n.Event.PostsInserted,{posts:t})});document.addEventListener("DOMContentLoaded",t=>{e.observe(document.body,{childList:!0,subtree:!0}),this.dispatchEvent(n.Event.Ready);const s=i.qsa(".post");s.length>0&&this.dispatchEvent(n.Event.PostsInserted,{posts:s})})}dispatchEvent(e,t=null){Object.keys(this.components).forEach(s=>{const n=this.components[s];try{n.dispatchEvent(e,t)}catch(e){console.error(e)}})}addComponent(e){this.components[e.constructor.name]=e}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),i=s(0),o=s(2);t.default=class extends n.default{constructor(e){super(e),this.styles={},i.qsa("link[title]").forEach(e=>{const t=e.title,s=e.getAttribute("href");this.styles[t]=s,e.remove()});const t=o.get("tinyib_style","Synthwave");this.setStyle(t)}onReady(){const e=i.qid("style-switcher");if(e){const t=Object.keys(this.styles);for(let s=0;s<t.length;++s){const n=t[s];e.innerHTML+=`<option class="style-switcher__option" value="${n}">${n}</option>`}e.addEventListener("change",()=>{this.setStyle(e.value)})}const t=o.get("tinyib_style","Synthwave");window.dataLayer.push({theme:t})}setStyle(e){const t=i.qs("head");if(!t)return;const s=i.qs("link[data-selected]");if(s){if(s.title===e)return;s.remove()}const n=this.styles[e],r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=n,r.setAttribute("data-selected","true"),r.addEventListener("load",()=>{this.manager.emit("style loaded")}),t.appendChild(r);const a=new Date;a.setTime(a.getTime()+31536e6),o.set("tinyib_style",e,a),this.manager.emit("style changed")}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),i=s(0),o=s(2),r=s(4),a=s(5);t.default=class extends n.default{constructor(e){super(e),this.settings=JSON.parse(o.get("tinyib_settings","{}"))}getFormValues(){const e=i.qs('input[name="form_preview_align"]:checked'),t=i.qs('input[name="time_locale"]:checked'),s=i.qid("time_locale_custom_value"),n=i.qs('input[name="time_format"]:checked'),o=i.qid("time_format_custom_value"),r=i.qs('input[name="time_zone"]:checked'),a=i.qid("time_zone_fixed_offset");return{form_preview_align:e.value,time_locale:t.value,time_locale_custom_value:s.value,time_zone:r.value,time_zone_fixed_offset:Number(a.value),time_format:n.value,time_format_custom_value:o.value}}onReady(){const e=i.qid("settings_form");if(!e)return;const t=i.qid("status"),s=i.qid("time_locale_custom"),n=i.qid("time_locale_custom_value"),c=i.qid("time_format_custom"),l=i.qid("time_format_custom_value"),d=i.qid("time_zone_fixed"),u=i.qid("time_zone_fixed_offset"),m=i.qid("time_current_format");if(this.settings.form_preview_align){const e=i.qs(`input[name="form_preview_align"][value="${this.settings.form_preview_align}"]`);e&&(e.checked=!0)}if(this.settings.time_locale){const e=i.qs(`input[name="time_locale"][value="${this.settings.time_locale}"]`);e&&(e.checked=!0)}if(this.settings.time_format){const e=i.qs(`input[name="time_format"][value="${this.settings.time_format}"]`);e&&(e.checked=!0)}if(this.settings.time_zone){const e=i.qs(`input[name="time_zone"][value="${this.settings.time_zone}"]`);e&&(e.checked=!0)}n.value=this.settings.time_locale_custom_value||"",l.value=this.settings.time_format_custom_value||"",u.value=(this.settings.time_zone_fixed_offset||0).toString(),s&&n&&n.addEventListener("click",e=>{s.checked=!0}),c&&l&&l.addEventListener("click",e=>{c.checked=!0}),d&&u&&u.addEventListener("click",e=>{d.checked=!0}),e.addEventListener("submit",e=>{e.preventDefault();const s=new Date;s.setTime(s.getTime()+31536e6);const n=this.getFormValues();return o.set("tinyib_settings",JSON.stringify(n),s),t&&(t.innerHTML="",setTimeout(()=>{t.innerHTML="Settings saved."},1e3/3)),!1});const h=()=>{if(m)try{const e=a.DateTime.fromJSDate(new Date),t=this.getFormValues();m.innerHTML=r.default.format(e,t)}catch(e){m.innerHTML="Invalid format"}};h(),setInterval(h,1e3)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),i=s(0);t.default=class extends n.default{constructor(e){super(e)}processPost(e){}onReady(){const e=i.qsa(".post"),t=e.length;for(let s=0;s<t;++s)this.processPost(e[s])}onPostInsert(e){this.processPost(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(11),i=s(0);t.default=class extends n.default{constructor(e){super(e),this.posts={}}getPostRefLinkAuthorHtml(e){const t=i.qs(".post-header__name",e),s=i.qs(".post-header__tripcode",e),n=t?t.innerHTML:"",o=s?s.innerHTML:"";return n.length||o.length?`(<span class="post__reference-link-name">${n}</span>`+`<span class="post__reference-link-tripcode">${o}</span>)`:""}processPost(e){const t=+e.getAttribute("data-post-id");this.posts[t]=e,i.qsa("a[data-target-post-id]",e).map(e=>({element:e,id:+e.getAttribute("data-target-post-id")})).forEach(e=>{const t=this.posts[e.id];if(!t)return;const s=document.createElement("span");s.classList.add("post__reference-link-author"),s.innerHTML=this.getPostRefLinkAuthorHtml(t);const n=e.element.parentElement,i=e.element.nextSibling;n.insertBefore(s,i)})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),i=s(0),o=s(2);t.default=class extends n.default{constructor(e){super(e)}onReady(){if(!i.qid("delform"))return;const e=i.qid("deletepostpassword");e&&(e.value=o.get("tinyib_password"))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(5),i=s(1),o=s(0),r=s(2),a=s(4);t.default=class extends i.default{constructor(e){super(e),this.settings=JSON.parse(r.get("tinyib_settings","{}"))}correctTime(e){const t=e.getAttribute("datetime");if(!t)return;const s=n.DateTime.fromISO(t);e.textContent=a.default.format(s,this.settings)}onReady(){o.qsa(".post-header__datetime").forEach(e=>this.correctTime(e))}onPostInsert(e){const t=o.qs(".post-header__datetime",e);t&&this.correctTime(t)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),i=s(0);t.default=class extends n.default{constructor(e){super(e),this.original_src=""}onReady(){const e=i.qid("captchaimage");e&&(this.original_src=e.src,e.addEventListener("click",()=>this.reload()))}reload(){const e=i.qid("captcha");return e.value="",e.focus(),i.qid("captchaimage").src=`${this.original_src}#${(new Date).getTime()}`,!1}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);t.default=class{constructor(e=!1){if(this.modules={},e){const e=new MutationObserver(e=>{const t=e.map(e=>{const t=e.addedNodes;return Array.prototype.slice.call(t).filter(e=>e.nodeType===Node.ELEMENT_NODE).map(e=>e.classList.contains("post")?[e]:n.qsa(".post",e)).reduce((e,t)=>e.concat(t),[])}).reduce((e,t)=>e.concat(t),[]);t.length>0&&this.insertPosts(t)});document.addEventListener("DOMContentLoaded",()=>{e.observe(document.body,{childList:!0,subtree:!0})})}document.addEventListener("DOMContentLoaded",()=>{this.forEachModule((e,t)=>new Promise((s,n)=>{try{t.onReady()}catch(t){console.error(`Error in ${e}.onReady(): ${t}`),n(t)}s()}))}),window.addEventListener("resize",()=>{this.forEachModule((e,t)=>new Promise(()=>{try{t.onResize()}catch(t){console.error(`Error in ${e}.onResize(): ${t}`)}}))})}forEachModule(e){return Object.keys(this.modules).map(t=>{const s=this.modules[t];return e(t,s)})}addModule(e,t){this.modules[e]=t}emit(e,t){this.forEachModule((s,n)=>new Promise(()=>{try{n.onEvent(e,t)}catch(t){console.error(`Error in ${s}.onEvent(${e}): ${t}`)}}))}insertPosts(e){console.debug("Inserted posts: ",e),this.forEachModule((t,s)=>new Promise((n,i)=>{try{e.forEach(e=>s.onPostInsert(e))}catch(e){console.error(`Error in ${t}.onPostInsert(): ${e}`),i(e)}n()}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(16),i=s(15),o=s(14),r=s(13),a=s(12),c=s(10),l=s(9),d=s(8),u=s(7);(new d.ComponentManager).addComponent(new u.PostingForm);const m=new n.default(!0);m.addModule("Captcha",new i.default(m)),m.addModule("CorrectTime",new o.default(m)),m.addModule("DeleteForm",new r.default(m)),m.addModule("PostReferenceMap",new a.default(m)),m.addModule("Settings",new c.default(m)),m.addModule("StyleSwitcher",new l.default(m)),window.tinyib={},window.tinyib.moduleManager=m}]);