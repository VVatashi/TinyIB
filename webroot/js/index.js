!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=14)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qid=function(e){return document.getElementById(e)},t.qs=function(e,t=null){return t||(t=document),t.querySelector(e)},t.qsa=function(e,t=null){t||(t=document);const s=t.querySelectorAll(e);return Array.prototype.slice.call(s)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.manager=e}onReady(){}onResize(){}onPostInsert(e){}onEvent(e,t){}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=function(e,t=null){const s=`; ${document.cookie}`.split(`; ${e}=`);if(2===s.length){const e=s.pop().split(";").shift();return decodeURIComponent(e)}return t},t.set=function(e,t,s){const i=encodeURIComponent(t),n=s.toUTCString();document.cookie=`${e}=${i}; path=/; expires=${n}`}},function(e,t){e.exports=luxon},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3);t.default=class{static format(e,t){const s=t.time_locale,n=t.time_locale_custom_value,o=t.time_zone,r=t.time_zone_fixed_offset,a=t.time_format,d=t.time_format_custom_value;if("custom"===s&&(e=e.setLocale(n)),"fixed"===o){const t="UTC"+(r>=0?"+":"")+r.toString();e=e.setZone(t)}if("custom"===a)return e.toFormat(d);{const t=Object.assign({},i.DateTime.DATETIME_FULL_WITH_SECONDS);return t.timeZone=void 0,t.timeZoneName=void 0,e.toLocaleString(t)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(2);t.default=class extends i.default{constructor(e){super(e),this.styles={},n.qsa("link[title]").forEach(e=>{const t=e.title,s=e.getAttribute("href");this.styles[t]=s,e.remove()});const t=o.get("tinyib_style","Synthwave");this.setStyle(t)}onReady(){const e=n.qid("style-switcher");if(e){const t=Object.keys(this.styles);for(let s=0;s<t.length;++s){const i=t[s];e.innerHTML+=`<option class="style-switcher__option" value="${i}">${i}</option>`}e.addEventListener("change",()=>{this.setStyle(e.value)})}}setStyle(e){const t=n.qs("head");if(!t)return;const s=n.qs("link[data-selected]");if(s){if(s.title===e)return;s.remove()}const i=this.styles[e],r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=i,r.setAttribute("data-selected","true"),r.addEventListener("load",()=>{this.manager.emit("style loaded")}),t.appendChild(r);const a=new Date;a.setTime(a.getTime()+31536e6),o.set("tinyib_style",e,a),this.manager.emit("style changed")}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(2),r=s(4),a=s(3);t.default=class extends i.default{constructor(e){super(e),this.settings=JSON.parse(o.get("tinyib_settings","{}"))}getFormValues(){const e=n.qs('input[name="form_preview_align"]:checked'),t=n.qs('input[name="time_locale"]:checked'),s=n.qid("time_locale_custom_value"),i=n.qs('input[name="time_format"]:checked'),o=n.qid("time_format_custom_value"),r=n.qs('input[name="time_zone"]:checked'),a=n.qid("time_zone_fixed_offset");return{form_preview_align:e.value,time_locale:t.value,time_locale_custom_value:s.value,time_zone:r.value,time_zone_fixed_offset:Number(a.value),time_format:i.value,time_format_custom_value:o.value}}onReady(){const e=n.qid("settings_form");if(!e)return;const t=n.qid("status"),s=n.qid("time_locale_custom"),i=n.qid("time_locale_custom_value"),d=n.qid("time_format_custom"),c=n.qid("time_format_custom_value"),l=n.qid("time_zone_fixed"),u=n.qid("time_zone_fixed_offset"),f=n.qid("time_current_format");if(this.settings.form_preview_align){const e=n.qs(`input[name="form_preview_align"][value="${this.settings.form_preview_align}"]`);e&&(e.checked=!0)}if(this.settings.time_locale){const e=n.qs(`input[name="time_locale"][value="${this.settings.time_locale}"]`);e&&(e.checked=!0)}if(this.settings.time_format){const e=n.qs(`input[name="time_format"][value="${this.settings.time_format}"]`);e&&(e.checked=!0)}if(this.settings.time_zone){const e=n.qs(`input[name="time_zone"][value="${this.settings.time_zone}"]`);e&&(e.checked=!0)}i.value=this.settings.time_locale_custom_value||"",c.value=this.settings.time_format_custom_value||"",u.value=(this.settings.time_zone_fixed_offset||0).toString(),s&&i&&i.addEventListener("click",e=>{s.checked=!0}),d&&c&&c.addEventListener("click",e=>{d.checked=!0}),l&&u&&u.addEventListener("click",e=>{l.checked=!0}),e.addEventListener("submit",e=>{e.preventDefault();const s=new Date;s.setTime(s.getTime()+31536e6);const i=this.getFormValues();return o.set("tinyib_settings",JSON.stringify(i),s),t&&(t.innerHTML="",setTimeout(()=>{t.innerHTML="Settings saved."},1e3/3)),!1});const m=()=>{if(f)try{const e=a.DateTime.fromJSDate(new Date),t=this.getFormValues();f.innerHTML=r.default.format(e,t)}catch(e){f.innerHTML="Invalid format"}};m(),setInterval(m,1e3)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0);t.default=class extends i.default{constructor(e){super(e)}onReady(){const e=window.location.hash;if(e){const t=e.match(/^#q\d+$/i);if(null!==t){const e=Number(t[0].substr(2));this.quotePost(e)}}n.qsa(".post-header__reflink").forEach(e=>{const t=Number(e.getAttribute("data-id"));e.addEventListener("click",()=>this.quotePost(t))})}quotePost(e){const t=n.qid("message");return t.value=`${t.value}>>${e}\n`,t.focus(),!1}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(2);t.default=class extends i.default{constructor(e){super(e),this.resize_width=!1,this.resize_height=!1,this.beginResize=(e=>{const t=document.body.getBoundingClientRect(),s=this.form.getBoundingClientRect(),i=e.pageX-(s.left-t.left),n=e.pageY-(s.top-t.top);this.resize_width=i>this.form.clientWidth-10,this.resize_height=n>this.form.clientHeight-10,window.addEventListener("mousemove",this.resize),window.addEventListener("mouseup",this.endResize)}),this.resize=(e=>{const t=document.body.getBoundingClientRect(),s=this.form.getBoundingClientRect(),i=e.pageX-(s.left-t.left),n=e.pageY-(s.top-t.top);this.resize_width&&(this.form.style.width=`${i}px`),this.resize_height&&(this.form.style.height=`${n}px`),(this.resize_width||this.resize_height)&&(e.preventDefault(),e.stopPropagation())}),this.endResize=(e=>{window.removeEventListener("mousemove",this.resize),window.removeEventListener("mouseup",this.endResize)}),this.settings=JSON.parse(o.get("tinyib_settings","{}")),this.form=null}insertMarkup(e,t){const s=n.qid("message");if(s){const i=s.value,n=s.selectionStart,o=s.selectionEnd;s.value=[i.substring(0,n),e,i.substring(n,o),t,i.substring(o)].join(""),s.focus(),s.selectionStart=n+e.length,s.selectionEnd=n+e.length+(o-n)}return!1}insertBBCode(e){return this.insertMarkup(`[${e}]`,`[/${e}]`)}setupMarkupButtons(){const e={markup_quote:()=>this.insertMarkup(">",""),markup_b:()=>this.insertBBCode("b"),markup_i:()=>this.insertBBCode("i"),markup_u:()=>this.insertBBCode("u"),markup_s:()=>this.insertBBCode("s"),markup_sup:()=>this.insertBBCode("sup"),markup_sub:()=>this.insertBBCode("sub"),markup_spoiler:()=>this.insertBBCode("spoiler"),markup_code:()=>this.insertBBCode("code"),markup_rp:()=>this.insertBBCode("rp")};Object.keys(e).forEach(t=>{const s=n.qid(t);s&&s.addEventListener("click",e[t])})}onReady(){if(this.form=n.qid("postform"),!this.form)return;const e=n.qid("name");e&&(e.value=o.get("tinyib_name",""),e.addEventListener("change",()=>{const t=new Date;t.setTime(t.getTime()+31536e6),o.set("tinyib_name",e.value,t)})),this.setupMarkupButtons();const t=n.qid("message");t&&(t.setAttribute("style",""),t.classList.remove("de-textarea"));const s=n.qid("de-resizer-text");s&&s.setAttribute("style","display: none !important;");const i=n.qs(".de-file",this.form);if(i){const e=document.createElement("tr");e.classList.add("form__field","form__field_fixed-width","field");const t=document.createElement("td");t.classList.add("field__label-wrapper"),e.appendChild(t);const s=document.createElement("td");s.classList.add("field__input-wrapper"),s.appendChild(i),e.appendChild(s);const o=n.qs(".form__group_message",this.form);"left"===this.settings.form_preview_align?o.insertBefore(e,o.firstChild):o.appendChild(e)}const r=n.qid("newpostpassword");r&&(r.value=o.get("tinyib_password"),r.addEventListener("change",()=>{const e=new Date;e.setTime(e.getTime()+31536e6),o.set("tinyib_password",r.value,e)})),this.form.addEventListener("mousedown",this.beginResize)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0);t.default=class extends i.default{constructor(e){super(e)}onReady(){this.setupHandlers()}onPostInsert(e){setTimeout(()=>{const t=n.qsa(".file-info__link, .thumbnail, .original",e);for(let e=0;e<t.length;++e){const s=Number(t[e].getAttribute("data-id"));t[e].addEventListener("click",e=>this.expandFile(e,s))}},100)}setupHandlers(){const e=n.qsa(".file-info__link, .thumbnail, .original");for(let t=0;t<e.length;++t){const s=Number(e[t].getAttribute("data-id"));e[t].addEventListener("click",e=>this.expandFile(e,s))}}scrollIntoView(e){const t=window.scrollY||window.pageYOffset,s=window.innerHeight;let i=0;const n=e.offsetHeight;for(let t=e;t&&"BODY"!==t.tagName;t=t.offsetParent)i+=t.offsetTop;t+s<i+n?e.scrollIntoView(!1):i<t&&e.scrollIntoView(!0)}expandFile(e,t){if(void 0===e||void 0===e.which||1===e.which){e&&e.preventDefault();const s=n.qid(`thumbnail_wrapper_${t}`),i=n.qid(`original_wrapper_${t}`);if("true"!==s.getAttribute("data-expanded")){s.setAttribute("data-expanded","true");const e=n.qid(`expand_${t}`);i.innerHTML=decodeURIComponent(e.textContent),i.style.visibility="hidden",setTimeout(()=>{s.style.display="none",i.style.visibility="visible",i.style.display="",this.scrollIntoView(i)},100)}else{s.setAttribute("data-expanded","false"),i.style.display="none",i.innerHTML="",s.style.display="";const e=n.qid(`thumbnail_${t}`);this.scrollIntoView(e)}return!1}return!0}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0),o=s(2);t.default=class extends i.default{constructor(e){super(e)}onReady(){if(!n.qid("delform"))return;const e=n.qid("deletepostpassword");e&&(e.value=o.get("tinyib_password"))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3),n=s(1),o=s(0),r=s(2),a=s(4);t.default=class extends n.default{constructor(e){super(e),this.settings=JSON.parse(r.get("tinyib_settings","{}"))}correctTime(e){const t=e.getAttribute("datetime");if(!t)return;const s=i.DateTime.fromISO(t);e.textContent=a.default.format(s,this.settings)}onReady(){o.qsa(".post-header__datetime").forEach(e=>this.correctTime(e))}onPostInsert(e){const t=o.qs(".post-header__datetime",e);t&&this.correctTime(t)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(0);t.default=class extends i.default{constructor(e){super(e),this.original_src=""}onReady(){const e=n.qid("captchaimage");e&&(this.original_src=e.src,e.addEventListener("click",()=>this.reload()))}reload(){const e=n.qid("captcha");return e.value="",e.focus(),n.qid("captchaimage").src=`${this.original_src}#${(new Date).getTime()}`,!1}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0);t.default=class{constructor(e=!1){if(this.modules={},e){const e=new MutationObserver(e=>{const t=e.map(e=>{const t=e.addedNodes;return Array.prototype.slice.call(t).filter(e=>e.nodeType===Node.ELEMENT_NODE).map(e=>e.classList.contains("post")?[e]:i.qsa(".post",e)).reduce((e,t)=>e.concat(t),[])}).reduce((e,t)=>e.concat(t),[]);t.length>0&&this.insertPosts(t)});document.addEventListener("DOMContentLoaded",()=>{e.observe(document.body,{childList:!0,subtree:!0})})}document.addEventListener("DOMContentLoaded",()=>{this.forEachModule((e,t)=>new Promise((s,i)=>{try{t.onReady()}catch(t){console.error(`Error in ${e}.onReady(): ${t}`),i(t)}s()}))}),window.addEventListener("resize",()=>{this.forEachModule((e,t)=>new Promise(()=>{try{t.onResize()}catch(t){console.error(`Error in ${e}.onResize(): ${t}`)}}))})}forEachModule(e){return Object.keys(this.modules).map(t=>{const s=this.modules[t];return e(t,s)})}addModule(e,t){this.modules[e]=t}emit(e,t){this.forEachModule((s,i)=>new Promise(()=>{try{i.onEvent(e,t)}catch(t){console.error(`Error in ${s}.onEvent(${e}): ${t}`)}}))}insertPosts(e){console.debug("Inserted posts: ",e),this.forEachModule((t,s)=>new Promise((i,n)=>{try{e.forEach(e=>s.onPostInsert(e))}catch(e){console.error(`Error in ${t}.onPostInsert(): ${e}`),n(e)}i()}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(13),n=s(12),o=s(11),r=s(10),a=s(9),d=s(8),c=s(7),l=s(6),u=s(5),f=new i.default(!0);f.addModule("Captcha",new n.default(f)),f.addModule("CorrectTime",new o.default(f)),f.addModule("DeleteForm",new r.default(f)),f.addModule("ExpandFile",new a.default(f)),f.addModule("PostForm",new d.default(f)),f.addModule("QuotePost",new c.default(f)),f.addModule("Settings",new l.default(f)),f.addModule("StyleSwitcher",new u.default(f)),window.tinyib={},window.tinyib.moduleManager=f}]);