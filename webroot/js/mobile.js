!function(e){var t={};function s(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=12)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qid=function(e){return document.getElementById(e)},t.qs=function(e,t=null){return t||(t=document),t.querySelector(e)},t.qsa=function(e,t=null){t||(t=document);const s=t.querySelectorAll(e);return Array.prototype.slice.call(s)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(2),r=s(0);t.default=class extends o.default{constructor(e){super(e)}processPost(e){}onReady(){const e=r.qsa(".post"),t=e.length;for(let s=0;s<t;++s)this.processPost(e[s])}onPostInsert(e){this.processPost(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.manager=e}onReady(){}onResize(){}onPostInsert(e){}onEvent(e,t){}}},function(e,t){e.exports=axios},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),r=s(0),n=s(3);t.default=class extends o.default{constructor(e){super(e),this.latestPostId=0}processPost(e){const t=e.getAttribute("data-post-id");this.latestPostId=Math.max(this.latestPostId,+t)}onReady(){super.onReady();const e=r.qs(".thread");if(!e)return void console.warn(".thread is not found.");if(0!=+e.getAttribute("data-thread-page"))return;const t=+e.getAttribute("data-thread-id");setInterval(()=>{const s=this.latestPostId;n.default.get(`${window.baseUrl}/ajax/mobile/thread/${t}?after=${s}`).then(t=>{const s=r.qs(".thread__posts",e);if(s&&t.data&&t.data.length){const e=document.createElement("div");e.classList.add("fadable","fade"),e.insertAdjacentHTML("beforeend",t.data),s.appendChild(e),setTimeout(()=>{e.classList.remove("fade")},100);const o=r.qsa(".thread__post",s);for(let e=0;e<o.length-50;++e)o[e].remove()}})},15e3)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),r=s(0);t.default=class extends o.default{constructor(e){super(e),this.posts={}}processPost(e){const t=+e.getAttribute("data-post-id");this.posts[t]=e,r.qsa("a[data-target-post-id]",e).map(e=>+e.getAttribute("data-target-post-id")).map(e=>this.posts[e]).filter(e=>e).forEach(e=>{let s=r.qs(".post__footer",e);s||((s=document.createElement("div")).classList.add("post__footer"),e.appendChild(s));const o=document.createElement("a");o.classList.add("post__reference-link"),o.href=`#post_${t}`,o.textContent=`>>${t}`,s.appendChild(o)})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),r=s(0);t.default=class extends o.default{constructor(e){super(e)}processPost(e){const t=r.qs(".post__id-link",e);t&&t.addEventListener("click",e=>{e.preventDefault();const s=t.getAttribute("data-post-id");return this.manager.emit("insertMarkup",[`>>${s}\n`,"",!0]),!1})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),r=s(0);t.default=class extends o.default{constructor(e){super(e),this.scale=1,this.offsetX=0,this.offsetY=0,this.dragStartOffsetX=0,this.dragStartOffsetY=0,this.dragStartMouseX=0,this.dragStartMouseY=0}closeModal(e){this.scale=1,this.offsetX=0,this.offsetY=0,e.classList.add("fade"),setTimeout(()=>{e.remove()},333)}transformModal(e){r.qs(".modal__image",e).style.transform=`translate(${this.offsetX}px, ${this.offsetY}px) scale(${this.scale})`}openModal(e){const t=document.createElement("img");t.classList.add("modal__image"),t.src=e.href,t.addEventListener("dragstart",e=>(e.preventDefault(),!1)),t.addEventListener("click",e=>(e.preventDefault(),e.stopPropagation(),!1)),t.addEventListener("mousedown",e=>{e.preventDefault(),this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.dragStartMouseX=e.pageX,this.dragStartMouseY=e.pageY;const o=e=>{e.preventDefault();const t=e.pageX-this.dragStartMouseX,o=e.pageY-this.dragStartMouseY;return this.offsetX=this.dragStartOffsetX+t,this.offsetY=this.dragStartOffsetY+o,this.transformModal(s),!1},r=e=>(e.preventDefault(),document.removeEventListener("mousemove",o),t.removeEventListener("mouseup",r),(Math.abs(this.offsetX-this.dragStartOffsetX)<.01||Math.abs(this.offsetY-this.dragStartOffsetY)<.01)&&this.closeModal(s),!1);return document.addEventListener("mousemove",o),t.addEventListener("mouseup",r),!1});const s=document.createElement("div");s.classList.add("layout__modal","modal"),s.appendChild(t),s.addEventListener("click",e=>(e.preventDefault(),this.closeModal(s),!1)),s.addEventListener("wheel",e=>(e.preventDefault(),this.scale=(1-.1*Math.sign(e.deltaY))*this.scale,this.transformModal(s),!1)),e.parentElement.appendChild(s),s.classList.add("fadable","fade"),setTimeout(()=>{s.classList.remove("fade")},100)}processPost(e){const t=r.qs(".post__thumbnail-link",e);t&&t.addEventListener("click",e=>(e.preventDefault(),this.openModal(t),!1))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(2),r=s(0);t.default=class extends o.default{constructor(e){super(e)}insertMarkup(e,t,s,o=!1){const r=e.value,n=e.selectionStart,a=e.selectionEnd,i=r.substring(0,n),d=r.substring(n,a),c=r.substring(a);o&&i.length&&!i.endsWith("\n")&&(t=`\n${t}`),e.value=[i,t,d,s,c].join(""),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length+(a-n)}insertBBCode(e,t){return this.insertMarkup(e,`[${t}]`,`[/${t}]`)}onReady(){const e=r.qid("postform");if(!e)return void console.warn("#postform is not found.");const t=r.qs("#subject",e);if(t){const e=localStorage.getItem("postform.subject");e&&(t.value=e),t.addEventListener("change",e=>{localStorage.setItem("postform.subject",t.value)})}const s=r.qs("#name",e);if(s){const e=localStorage.getItem("postform.name");e&&(s.value=e),s.addEventListener("change",e=>{localStorage.setItem("postform.name",s.value)})}const o=r.qs("#email",e);if(o){const e=localStorage.getItem("postform.email");e&&(o.value=e),o.addEventListener("change",e=>{localStorage.setItem("postform.email",o.value)})}const n=r.qs("#message",e);if(n){const t={"postform-markup-bold":e=>this.insertBBCode(n,"b"),"postform-markup-italic":e=>this.insertBBCode(n,"i"),"postform-markup-underline":e=>this.insertBBCode(n,"u"),"postform-markup-strike":e=>this.insertBBCode(n,"s"),"postform-markup-sup":e=>this.insertBBCode(n,"sup"),"postform-markup-sub":e=>this.insertBBCode(n,"sub"),"postform-markup-spoiler":e=>this.insertBBCode(n,"spoiler"),"postform-markup-rp":e=>this.insertBBCode(n,"rp"),"postform-markup-code":e=>this.insertBBCode(n,"code"),"postform-markup-quote":e=>this.insertMarkup(n,">","",!0)};Object.keys(t).forEach(s=>{const o=r.qs(`#${s}`,e);o&&o.addEventListener("click",t[s])})}r.qsa("#file",e).forEach(e=>{e.addEventListener("change",t=>{if(e.files&&e.files.length){const t=new FileReader;t.addEventListener("load",t=>{const s=e.parentElement;let o=r.qs(".form__file-preview",s);o||((o=document.createElement("img")).classList.add("form__file-preview"),s.appendChild(o)),o.src=t.target.result}),t.readAsDataURL(e.files[0])}})})}onEvent(e,t){if("insertMarkup"===e){const e=r.qid("postform");if(!e)return void console.warn("#postform is not found.");const s=r.qs("#message",e);if(!s)return void console.warn("#message is not found.");t.unshift(s),this.insertMarkup.apply(this,t)}}}},function(e,t){e.exports=luxon},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),r=s(0),n=s(9);t.default=class extends o.default{constructor(e){super(e)}processPost(e){const t=r.qs(".post__date",e);if(t){const e=t.getAttribute("datetime"),s=n.DateTime.fromISO(e);t.textContent=s.toLocaleString(n.DateTime.DATETIME_MED_WITH_SECONDS)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(0);t.default=class{constructor(){this.modules={};const e=new MutationObserver(e=>{const t=e.map(e=>{const t=e.addedNodes;return Array.prototype.slice.call(t).filter(e=>e.nodeType===Node.ELEMENT_NODE).map(e=>e.classList.contains("post")?[e]:o.qsa(".post",e)).reduce((e,t)=>e.concat(t),[])}).reduce((e,t)=>e.concat(t),[]);this.forEachModule((e,s)=>new Promise((o,r)=>{try{t.forEach(e=>s.onPostInsert(e))}catch(t){console.error(`Error in ${e}.onPostInsert(): ${t}`),r(t)}o()}))});document.addEventListener("DOMContentLoaded",()=>{e.observe(document.body,{childList:!0,subtree:!0}),this.forEachModule((e,t)=>new Promise((s,o)=>{try{t.onReady()}catch(t){console.error(`Error in ${e}.onReady(): ${t}`),o(t)}s()}))}),window.addEventListener("resize",()=>{this.forEachModule((e,t)=>new Promise(()=>{try{t.onResize()}catch(t){console.error(`Error in ${e}.onResize(): ${t}`)}}))})}forEachModule(e){return Object.keys(this.modules).map(t=>{const s=this.modules[t];return e(t,s)})}addModule(e,t){this.modules[e]=t}emit(e,t){this.forEachModule((s,o)=>new Promise(()=>{try{o.onEvent(e,t)}catch(t){console.error(`Error in ${s}.onEvent(${e}): ${t}`)}}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(11),r=s(10),n=s(8),a=s(7),i=s(6),d=s(5),c=s(4),u=new o.default;u.addModule("PostCorrectTime",new r.default(u)),u.addModule("PostForm",new n.default(u)),u.addModule("PostImagePopup",new a.default(u)),u.addModule("PostQuote",new i.default(u)),u.addModule("PostReferenceMap",new d.default(u)),u.addModule("ThreadUpdater",new c.default(u)),window.tinyib={},window.tinyib.moduleManager=u}]);