!function(t){var e={};function s(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(o,r,function(e){return t[e]}.bind(null,r));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=12)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.qid=function(t){return document.getElementById(t)},e.qs=function(t,e=null){return e||(e=document),e.querySelector(t)},e.qsa=function(t,e=null){e||(e=document);const s=e.querySelectorAll(t);return Array.prototype.slice.call(s)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(2),r=s(0);e.default=class extends o.default{constructor(t){super(t)}processPost(t){}onReady(){const t=r.qsa(".post"),e=t.length;for(let s=0;s<e;++s)this.processPost(t[s])}onPostInsert(t){this.processPost(t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.manager=t}onReady(){}onResize(){}onPostInsert(t){}onEvent(t,e){}}},function(t,e){t.exports=axios},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(1),r=s(0),n=s(3);e.default=class extends o.default{constructor(t){super(t),this.latestPostId=0}processPost(t){const e=t.getAttribute("data-post-id");this.latestPostId=Math.max(this.latestPostId,+e)}onReady(){super.onReady();const t=r.qs(".thread");if(!t)return void console.warn(".thread is not found.");if(0!=+t.getAttribute("data-thread-page"))return;const e=+t.getAttribute("data-thread-id");setInterval(()=>{const s=this.latestPostId;n.default.get(`${window.baseUrl}/ajax/mobile/thread/${e}?after=${s}`).then(e=>{const s=r.qs(".thread__posts",t);if(s&&e.data&&e.data.length){const t=document.createElement("div");t.classList.add("fadable","fade"),t.insertAdjacentHTML("beforeend",e.data),s.appendChild(t),setTimeout(()=>{t.classList.remove("fade")},100);const o=r.qsa(".thread__post",s);for(let t=0;t<o.length-50;++t)o[t].remove()}})},15e3)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(1),r=s(0);e.default=class extends o.default{constructor(t){super(t),this.posts={}}processPost(t){const e=+t.getAttribute("data-post-id");this.posts[e]=t,r.qsa("a[data-target-post-id]",t).map(t=>+t.getAttribute("data-target-post-id")).map(t=>this.posts[t]).filter(t=>t).forEach(t=>{let s=r.qs(".post__footer",t);s||((s=document.createElement("div")).classList.add("post__footer"),t.appendChild(s));const o=document.createElement("a");o.classList.add("post__reference-link"),o.href=`#post_${e}`,o.textContent=`>>${e}`,s.appendChild(o)})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(1),r=s(0);e.default=class extends o.default{constructor(t){super(t)}processPost(t){const e=r.qs(".post__id-link",t);e&&e.addEventListener("click",t=>{t.preventDefault();const s=e.getAttribute("data-post-id");return this.manager.emit("insertMarkup",[`>>${s}\n`,"",!0]),!1})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(1),r=s(0);e.default=class extends o.default{constructor(t){super(t),this.scale=1,this.offsetX=0,this.offsetY=0,this.dragStartOffsetX=0,this.dragStartOffsetY=0,this.dragStartMouseX=0,this.dragStartMouseY=0}closeModal(t){this.scale=1,this.offsetX=0,this.offsetY=0,t.classList.add("fade"),setTimeout(()=>{t.remove()},333)}transformModal(t){r.qs(".modal__image",t).style.transform=`translate(${this.offsetX}px, ${this.offsetY}px) scale(${this.scale})`}openModal(t){let e;const s=t.getAttribute("data-file-type");if("video"===s){const s=document.createElement("video"),o=t.getAttribute("data-file-width"),r=t.getAttribute("data-file-height");s.classList.add("modal__video"),s.setAttribute("controls","controls"),s.setAttribute("preload","metadata"),s.setAttribute("width",o),s.setAttribute("height",r),s.src=t.href,e=s}else if("audio"===s){const s=document.createElement("audio");s.classList.add("modal__audio"),s.setAttribute("controls","controls"),s.setAttribute("preload","metadata"),s.src=t.href,e=s}else{const s=document.createElement("img");s.classList.add("modal__image"),s.src=t.href,e=s}e.addEventListener("dragstart",t=>(t.preventDefault(),!1)),e.addEventListener("click",t=>(t.preventDefault(),t.stopPropagation(),!1)),e.addEventListener("mousedown",t=>{t.preventDefault(),this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.dragStartMouseX=t.pageX,this.dragStartMouseY=t.pageY;const s=t=>{t.preventDefault();const e=t.pageX-this.dragStartMouseX,s=t.pageY-this.dragStartMouseY;return this.offsetX=this.dragStartOffsetX+e,this.offsetY=this.dragStartOffsetY+s,this.transformModal(o),!1},r=t=>(t.preventDefault(),document.removeEventListener("mousemove",s),e.removeEventListener("mouseup",r),(Math.abs(this.offsetX-this.dragStartOffsetX)<.01||Math.abs(this.offsetY-this.dragStartOffsetY)<.01)&&this.closeModal(o),!1);return document.addEventListener("mousemove",s),e.addEventListener("mouseup",r),!1});const o=document.createElement("div");o.classList.add("layout__modal","modal"),o.appendChild(e),o.addEventListener("click",t=>(t.preventDefault(),this.closeModal(o),!1)),o.addEventListener("wheel",t=>(t.preventDefault(),this.scale=(1-.1*Math.sign(t.deltaY))*this.scale,this.transformModal(o),!1)),t.parentElement.appendChild(o),o.classList.add("fadable","fade"),setTimeout(()=>{o.classList.remove("fade")},100)}processPost(t){const e=r.qs(".post__thumbnail-link",t);e&&e.addEventListener("click",t=>(t.preventDefault(),this.openModal(e),!1))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(2),r=s(0);e.default=class extends o.default{constructor(t){super(t)}insertMarkup(t,e,s,o=!1){const r=t.value,n=t.selectionStart,a=t.selectionEnd,i=r.substring(0,n),d=r.substring(n,a),c=r.substring(a);o&&i.length&&!i.endsWith("\n")&&(e=`\n${e}`),t.value=[i,e,d,s,c].join(""),t.focus(),t.selectionStart=n+e.length,t.selectionEnd=n+e.length+(a-n)}insertBBCode(t,e){return this.insertMarkup(t,`[${e}]`,`[/${e}]`)}onReady(){const t=r.qid("postform");if(!t)return void console.warn("#postform is not found.");const e=r.qs("#subject",t);if(e){const t=localStorage.getItem("postform.subject");t&&(e.value=t),e.addEventListener("change",t=>{localStorage.setItem("postform.subject",e.value)})}const s=r.qs("#name",t);if(s){const t=localStorage.getItem("postform.name");t&&(s.value=t),s.addEventListener("change",t=>{localStorage.setItem("postform.name",s.value)})}const o=r.qs("#email",t);if(o){const t=localStorage.getItem("postform.email");t&&(o.value=t),o.addEventListener("change",t=>{localStorage.setItem("postform.email",o.value)})}const n=r.qs("#message",t);if(n){const e={"postform-markup-bold":t=>this.insertBBCode(n,"b"),"postform-markup-italic":t=>this.insertBBCode(n,"i"),"postform-markup-underline":t=>this.insertBBCode(n,"u"),"postform-markup-strike":t=>this.insertBBCode(n,"s"),"postform-markup-sup":t=>this.insertBBCode(n,"sup"),"postform-markup-sub":t=>this.insertBBCode(n,"sub"),"postform-markup-spoiler":t=>this.insertBBCode(n,"spoiler"),"postform-markup-rp":t=>this.insertBBCode(n,"rp"),"postform-markup-code":t=>this.insertBBCode(n,"code"),"postform-markup-quote":t=>this.insertMarkup(n,">","",!0)};Object.keys(e).forEach(s=>{const o=r.qs(`#${s}`,t);o&&o.addEventListener("click",e[s])})}r.qsa("#file",t).forEach(t=>{t.addEventListener("change",e=>{if(t.files&&t.files.length){const e=new FileReader;e.addEventListener("load",e=>{const s=t.parentElement;let o=r.qs(".form__file-preview",s);o||((o=document.createElement("img")).classList.add("form__file-preview"),s.appendChild(o)),o.src=e.target.result}),e.readAsDataURL(t.files[0])}})})}onEvent(t,e){if("insertMarkup"===t){const t=r.qid("postform");if(!t)return void console.warn("#postform is not found.");const s=r.qs("#message",t);if(!s)return void console.warn("#message is not found.");e.unshift(s),this.insertMarkup.apply(this,e)}}}},function(t,e){t.exports=luxon},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(1),r=s(0),n=s(9);e.default=class extends o.default{constructor(t){super(t)}processPost(t){const e=r.qs(".post__date",t);if(e){const t=e.getAttribute("datetime"),s=n.DateTime.fromISO(t);e.textContent=s.toLocaleString(n.DateTime.DATETIME_MED_WITH_SECONDS)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(0);e.default=class{constructor(){this.modules={};const t=new MutationObserver(t=>{const e=t.map(t=>{const e=t.addedNodes;return Array.prototype.slice.call(e).filter(t=>t.nodeType===Node.ELEMENT_NODE).map(t=>t.classList.contains("post")?[t]:o.qsa(".post",t)).reduce((t,e)=>t.concat(e),[])}).reduce((t,e)=>t.concat(e),[]);this.forEachModule((t,s)=>new Promise((o,r)=>{try{e.forEach(t=>s.onPostInsert(t))}catch(e){console.error(`Error in ${t}.onPostInsert(): ${e}`),r(e)}o()}))});document.addEventListener("DOMContentLoaded",()=>{t.observe(document.body,{childList:!0,subtree:!0}),this.forEachModule((t,e)=>new Promise((s,o)=>{try{e.onReady()}catch(e){console.error(`Error in ${t}.onReady(): ${e}`),o(e)}s()}))}),window.addEventListener("resize",()=>{this.forEachModule((t,e)=>new Promise(()=>{try{e.onResize()}catch(e){console.error(`Error in ${t}.onResize(): ${e}`)}}))})}forEachModule(t){return Object.keys(this.modules).map(e=>{const s=this.modules[e];return t(e,s)})}addModule(t,e){this.modules[t]=e}emit(t,e){this.forEachModule((s,o)=>new Promise(()=>{try{o.onEvent(t,e)}catch(e){console.error(`Error in ${s}.onEvent(${t}): ${e}`)}}))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=s(11),r=s(10),n=s(8),a=s(7),i=s(6),d=s(5),c=s(4),l=new o.default;l.addModule("PostCorrectTime",new r.default(l)),l.addModule("PostForm",new n.default(l)),l.addModule("PostImagePopup",new a.default(l)),l.addModule("PostQuote",new i.default(l)),l.addModule("PostReferenceMap",new d.default(l)),l.addModule("ThreadUpdater",new c.default(l)),window.tinyib={},window.tinyib.moduleManager=l}]);